
Achtung: Diese Funktionsbeschreibung beschreibt nicht exakt den finalen 
Funktionstand von 1.0, bitte das UCC-Handbuch verwenden.

UCC ist der Nachfolger von UCD und TCS. 

Der Rollout von UCC-Systemem erfolgt durch ein Image-basiertes Verfahren. 

Die Images basieren auf Kubuntu 12.04 und sind durch den Administrator
frei konfigurierbar. Lokal erstellt Images werden durch den Univention
Support erst nach einer Prüfung/Abnahme unterstützt.

Wichtige UCS-Basispakete wie univention-debug,
univention-config-registry, univention-policy, python-univention,
univention-lib, univention-ssh und univention-base-files (mit einem
Teil der Basis-UCR-Templates) sind für UCC gebaut. UCC-Systeme weisen
sich in den LSB-Identifikationen als UCC-Systeme aus.

Univention liefert zwei Images aus, ein minimales Image für Thin
Clients und ein größeres Image für native Installationen.  Diese
beiden Images werden auch fortlaufend gepflegt, z B. halbjährlich mit
Sicherheits-Updates aktualisiert. Die Images werden von Univention erstellt, getestet und
dann zum Download bereitgestellt. Die Images werden auf einem
Univention-Server bereitgestellt und über das Tool ucc-image-download
heruntergeladen. Metapakete für Thin Client und Desktop sorgen dafür,
dass immer die aktuellste Version installiert wird. Mit
ucc-image-remove können alte Images entfernt werden. Alle Images
registrieren sich über Join-Skripte im Managementsystem.

Das Thin-Client-Image bietet einen minimalen Desktop und Support für
RDP/UCC-Sitzungen. Ist keine Sitzung für den Client definiert oder der
Client nicht gejoint, wird LXDE im Gastmodus gestartet. Das Image wird
für i386 bereitgestellt. Thin Clients, die mit diesem Image betrieben
werden sollen, müssen min. zwei GB lokalen Speicher mitbringen (SSD
oder CompactFlash).

Das Desktop-Image bietet einen KDE-Plasma-Desktop und Support für alle
Terminalservervarianten der ICA-Client ist nicht redistributierbar und
muss nachinstalliert werden). Ist keine Sitzung für den Client definiert
oder der Client nicht gejoint, wird der KDE-Plasma-Desktopp mit einem
Gast-Benutzer gestartet werden. Das Image wird für i386 bereitgestellt.
Das Desktop-Image bringt ein deutsches, spanisches, französisches und
niederländisches Language Pack mit. Die Language Packs umfassen den 
Support für alle Regionen einer Sprachgruppe, d.h. für Deutsch
beispielsweise Österreich, Belgien, Schweiz, Deutschland, Liechenstein
und Luxemburg.

UCC wird im UCS-Managementsystem verwaltet. Die Pakete werden in einem
eigenen Scope ucc-integration gebaut. UCC setzt UCS 3.1 voraus.
Die Installation der Management-Komponenten erfolgt über das
Univention App Center.

Alle Einstellungen eines UCC-Clients werden über UCR-Richtlinien oder gesonderte
Richtlinien wie  "UCC-Client" kontrolliert.

Es wird keinen direkten Upgradepfad von UCD/TCS nach UCC geben:
Generell können die UCC-Pakete/LDAP-Schemata parallel zu einem
bestehenden UCD/TCS instaliert werden. Die Clients müssen dann von
separaten Servern mit UCC ausgerollt werden. Wenn alle Clients
umgestellt sind, können dann die TCS-Server entfernt werden.

IPv6-Support wird nicht explizit getestet, der Rollout funktioniert
aktuell nur über IPv4 (das Protokoll ist nicht IPv6-fähig). Es ist
aber wahrscheinlich, dass installierte Notebooks auch problemlos in
IPv6-Umgebungen funktionieren.

Das Handbuch und die erweiterte Dokumentation zu UCC wird nur in
Englisch verfügbar sein. Der Quickstart Guide wird in Deutsch und
Englisch verfügbar sein.

Auf den Systemen, die mit Images installiert werden, müssen
persistente Daten wie das Home der Benutzer von den Systemdaten
auf einer eigenen Partition getrennt gespeichert werden. Vor dem
Partitionieren wird noch einmal nachgefragt.
Systemdaten, die über ein Update hinweg erhalten bleiben müssen
(z.B. der Join-Status) werden in einer separaten /config-Partition
gespeichert. Die Verwaltung dieser Daten erfolgt über ein Tool
univention-ucc-sync-persistent-files, das UCR-Variablen und Dateien
speichert, die auch bei Neuinstallationen erhalten bleiben.
Der Start der Image-Installation kann über PXE oder lokale von einem
ISO-Image (DVD-ROM oder USB-Stick) gestartet werden. 

Technisch werden alle UCC-Systeme immer als Read/Write-Speichermedien
behandelt: Wird ein Image von einer Quelle eingebunden, die selbst nur
Lesezugriff erlaubt (von einer Live-DVD oder von einem NFS-Share),
wird ein Overlay-Dateisystem eingesetzt, das alle lokalen
Schreibvorgänge zwischenspeichert. Diese Änderungen gehen natürlich
mit dem Ausschalten des Systems verloren. Diese Technik sollte auch
bei Systemen mit Compact Flash-Speicher verwendet werden, da diese
Speichermedien nur für einige Tausend Schreibvorgänge konzipiert sind.

Insgesamt werden verschiedene Bootverfahren unterstützt, die im
Bootloader ausgewählt werden können: Wird per PXE gebootet, kann das
Startverfahren über das Managementsystem festgelegt werden:

 Boot über overlayfs (read-only Image für Thinclients oder Live CD)
 Installation auf die lokale Festplatte und Boot
 Aktualisierung des Images, sofern verfügbar und die MD5-Prüfsumme des
 angebotenen Images sich von der aktuell installierten unterscheidet
 Rollout (siehe unten)
 Boot des lokalen Images 
Das zu installierende Image wird über ein Dropdown-Auswahlfeld am
Rechner-Objekt im UCC-Managementsystem festgelegt. Die Images werden
über HTTP geladen, die früher vorgesehene Verteilung über Bittorrent
wird (zumindest zu 1.0) nicht umgesetzt. Eine Partitionierung wird nur
vorgenommen werden eine Erstinstallation auf einem nicht
partitionierten System vorgenommen wird oder eine Option im Reiter
"Images" gesetzt ist, die eine Neu-Partitionierung erzwingt (dieses
Flag wird automatisch zurückgesetzt). Das Partionierungs-Layout ist im
Image definiert.

Aktuelle Parted-Versionen in Ubuntu haben einen Bug, der dazu führt,
dass das "bootable"-Flag des Protective MBR beim Editieren einer
Partition verloren geht. Daher wird manuell das Flag durch ein Skript
gesetzt.

Größere Mengen von UCC-Systemen können folgendermassen importiert
werden:
- Die Systeme werden vorab durch ein Skript angelegt (existiert schon für
  RegioIT, kann als Cool Solution veröffentlicht werden).
- Die Installationvariante "Rollout" muss ausgewählt werden. Dabei
  wird das angelegte Rechnerkonto im LDAP gesucht und es erfolgt ein
  Domänenbeitritt. Das Passwort für den Join-Account muss dabei
  manuell angegeben werden. (Ein automatischer Join wird ggf. als Cool
  Solution bereitgestellt). Anschließend wird die Boot-Variante
  automatisch auf "none" zurückgesetzt.

Die UCC-Images werden über ein Toolkit generiert: Das Paket
ucc-image-toolkit stellt das Tool ucc-image bereit, dass die
Generierung von Images ermöglicht. Über eine Konfigurationsdatei
wird ein Image erzeugt. Konfiguriert werden können die folgenden
Parameter:
- Standard-Hostname
- Architektur
- Ubuntu-Release und eingebundene Paketquellen/Mirror
- Software-Pakete (mit und ohne Installation von Recommends)
- Standard-root-Passwort
- Versionsnummer
- Image-Namen
- Standardmässig gesetzte UCR-Variablen
- Ob der Start der Partitionierung bestätigt werden muss
- Dialog-Texte, die bei der Installation angezeigt werden
- Die Partitionierung der Festplatten/Speichermedien muss festgelegt
werden. Für weitergehende Partitionierungschritte wie die Einrichtung
einer verschlüsselten Festplatte kann ein Skript eingebunden werden.

Das Image-Toolkit erstellt neben dem Image auch eine Initrd und einen
Kernel, außerdem optional ein ISO-Image.

Images werden nicht als DEB ausgeliefert, da DEBs für die für das
Desktop-Image nötige Größe nicht skalieren. UCC-Images werden
stattdessen mit dem Tool ucc-image-download heruntergeladen. Die
einzelnen Dateien des Images werden dabei über eine Spec-Datei
referenziert, in der Dateinamen und SHA256-Hashes enthalten sind.
Es erfolgt eine Prüfung der Hash-Werte um Download-Fehler zu
erkennen. Der Download erfolgt über wget und ist damit proxy-fähig. Standardmäßig
werden abgebrochene Downloads wieder aufgenommen. Mit der Option "--reload"
kann auch ein vollständiger Neustart des Downloads erzwungen werden.
Das Root-Passwort wird in der Grundeinstellung auf das root-Passwortdes
aktuellen Systems gesetzt. Mit der Option "-p" erfolgt eine interaktive Angabe.
Es erfolgt eine Konsistenzprüfung, ob ausreichend Plattenplatz
vorhanden ist. Alte Images können mit ucc-image-remove entfernt werden.
ucc-default-images bringt Metapaket mit, die die jewels aktuelle
Version der UCC-Images herunterladen.

Der Rechnername eines UCC-Systems ist initial im Image festgelegt. Während des Joins
liest der Rechner seinen effektiven Namen aus dem Managementsystem aus.
Der Beitritt kann mit dem Tool univention-join erfolgen oder durch
Auswahl der Installationsmethode "Rollout", bei der automatisch ein
Domänenbeitritt durchgeführt wird.

Die Netzwerkkonfiguration eines UCC-Clients erfolgt generell über
DHCP. Optional besteht die Möglichkeit der Konfiguration einer
statischen IP-Adresse, z.B. für Terminalserver. Da ansonsten der
PXE-Boot fehlschlägt, wird das primäre Interface (eth0) standardmässig
nicht durch den Network Manager verwaltet. Es wäre überlegenswert beim
Start des Desktop-Images die Deaktivierung des Network Managers nur
für den Live-Boot durchzuführen.

Univention Configuration Registry-Variablen können auf UCC-Clients
über eine Richtlinie gesetzt werden. Außerdem ist Univention Directory
Policy auf UCC-Systemen verfügbar.

Über eine Richtlinie kann festgelegt werden welche Pakete auf einem
System installiert werden sollen und ob eine Aktualisierung
stattfinden soll. Diese Aktualisierung wird immer zum Start des
UCC-Systems durchgeführt.

UCC speichert Benutzer- und Gruppeninformationen lokal
zwischen. Dadurch kann auch offline mit einem UCC-System gearbeitet
werden: Ein Listener-Modul generiert eine Datei mit allen Benutzern
und Gruppen. Diese wird von den UCC-Clients durch libnss_extrausers
eingebunden. Die Datei wird beim Start des Systems vom UCC-Server
geladen und über den PAM-Stack aufgerufen, wenn der anmeldende
Benutzer nicht bekannt ist. Es wird pro System geprüft, ob es eine
System-spezifische passwd/group-Datei gibt. 
Auf Terminalservern wird das Skript alle
fünf Minuten über Cron aufgerufen. Der NSCD wird nicht mehr
verwendet. Passwort-Hashes werden über pam_ccreds zwischengespeichert,
so dass sich Benutzer, die sich vorher schon auf dem System angemeldet
hatten, weiterhin anmelden können.

Die Abfrage der LDAP-Server erfolgt redundant, d.h. es kann mehr
als ein LDAP-Server angegeben werden. Fällt einer aus, wird ein
anderer verwendet.

Alle UCC-Images haben ein initiales root-Passwort, das auf allen
Systemen identisch ist. Beim Download eines UCC-Images wird
standardmässig das aktuelle root-Passwort des UCC-Servers übernommen,
optional kann ein abweichendes root-Passwort festgelegt werden.

UCC verwendet LightDM als Anmeldemanager. Benutzer melden sich mit
ihrem Passwort aus dem UCS-Managementsystem an. Die Authentifizierung
erfolgt über Kerberos. Passwort-Wechsel sollten unterstützt werden.
Auf einem UCC-System, das noch nicht der Domäne
beigetreten ist, erfolgt eine automatische Anmeldung mit einem
Gast-Benutzer, der temporär erzeugt wird. LightDM verwendet ein
Hintergrundbild im UCC-Design. Der Login-Screen ist nicht weitergehend
auf UCC angepasst. Es können Session-Skripte aufgerufen werden, die
beim Start des Login-Managers oder der Benutzersitzung mit
root-Rechten aufgerufen werden. In einem dieser Skripte werden auch
die Benutzer- und Rechner-Richtlinien ausgewertet und unter /tmp
zwischengespeichert (da nur authentifiziert auf das UCS-LDAP
zugegriffen werden kann)
Es werden verschiedene Sitzungs-Skripte für LightDM mitgeliefert:
 "LXDE" startet einen minimalen LXDE-Desktop (für den Thin Client)
 "UCC" startet einen KDE-Plasma-Desktop (für den Desktop-Client). Der
 Desktop entspricht im wesentlichen dem Kubuntu-Desktop, verwendet
 aber das UCC-Hintergrundbild.
 "Frefox" startet einen Browser im Vollbild-Modus, die Startseite
    kann dabei über UCR konfiguriert werden.
 "XenApp" startet einen Browser, der auf die Citrix-Login-Seite
   verbindet (die über UCR konfiguriert wird). Ist der Citrix
   Receiver nicht installiert oder die Startseite nicht konfiguriert,
   wird ein entsprechender Hinweis als HTML-Datei angezeigt.
 "RDP" startet eine Verbindung zu einem Windows-Terminalserver über
   FreeRDP. Auf einem ungejointen System oder einem System, auf dem
   der Windows-Terminakserver nicht über das Managementsystem
   konfiguriert wurde wird der Desktop-Client Remmina gestartet, der
   eine manuell Konfiguration der Verbindung erlaubt.
 "UCC-remote" baut eine Verbindung zu einem UCC-Terminalserver auf.
   Sind mehrere Server verfügbar, wird der mit der geringsten Last
   verwendet.
Der Benutzer hat bei der Anmeldung auf einem gejointen System die
Auswahlmöglichkeit zwischen verschiedenen Sitzungen. Wenn für den
Benutzer über eine Richtlinie eine Sitzung vorgegeben wird, erfolgt
keine interaktive Auswahl der Session. 

Beim Start eines UCC-Clients wird ein Plymouth-Bootsplash-Theme im
UCC-Design angezeigt.

Über eine Benutzerrichtlinie kann die KDE-Sprache eine Benutzers
festgelegt werden. Außerdem eine Reihe von Umgebungsvariablen, die
beim Login gesetzt werden und eine Reihe von Login- und
Logout-Skripten, die bei An- und Abmeldung des Benutzers ausgeführt
werden.

UCC-Clients werden im UCS-Managementsystem verwaltet. Es gibt eine
eigenständige Systemrolle UCC und die typischen Rechnerattribute (IP,
Name, MAC, DNS/DHCP) sind analog zu UCS konfigurierbar.
Darüberhinaus gibt es eine Rechnerrichtlinie, die festlegt, ob lokaler
USB-Massenspeicher in einer Terminalsitzung verfügbar ist.
UCC wird in der Grundeinstellung die Xorg-Autokonfiguration
verwenden. Der Multimonitor-Betrieb ist zusätzlich über eine
Richtlinie konfigurierbar.

Das Tastaturlayout und die Locale des PXE-Servers werden beim
PXE-Start auf dem UCC-System in UCR gesetzt und in den Templates
ausgewertet, d.h. UCC-Systeme verwenden per Default dieselbe Locale
und Tastatur wie ihr UCC-Server. Abweichende Einstellungen können über
die UCR-Variablen xorg/keyboard/options/XkbLayout und locale/default
(analog zu UCS) gesetzt werden.

Die folgenden Terminalservices werden in UCC unterstützt:

RDP:
Der Zugriff erfolgt über freerdp. Der Windows-Terminalserver und
dessen Windows-Domäne werden über eine Benutzer-Richtlinie oder
alternativ pro Rechner über UCR festgelegt. Über UCR können
darüberhinaus die folgenden Parameter festgelegt werden:
- NLA und SSL-Checks
- Abweichendes Keyboard-Layout vom aktuellen
- Deaktivierung von Sound (standardmässig an). Die Ausgabe erfolgt
  über das xfreerdp-ALSA-Plugin

Es können beliebige weitere Optionen per UCR an freerdp übergeben
werden.

Das Passwort wird über ein PAM-Modul in /tmp base64-codiert
zwischengespeichert und muss nicht erneut eingegeben werden.
Massenspeicher wird in der RDP-Sitzung weitergereicht, wenn es in der
Richtlinie des Rechners konfiguriert ist.

Getestet wird der RDP-Support gegen die Standardkonfiguration eines
Windows 2003 und eines Windows 2008R2-Terminalservers.

XenApp:
Unterstützt wird nur noch die browser-basierte
Zugriffsvariante. Hierbei wird eine Citrix-Farm konfiguriert, die über
ein Web-Interface einem Benutzer nach erfolgter Authentifizierung eine
Auswahl an Terminalsitzunen anbietet. Klickt der Benutzer auf eine
Sitzung, wird serverseitigt eine ICA-Datei generiert, die über ein
Browser-Plugin den Citrix Receiver startet. Der Citrix Receiver darf
nicht mit UCC ausgeliefert werden und muss nachinstalliert werden. Bei
der Installation muss eine EULA bestätigt werden. Es gibt ein
Sitzungsskript, das die per UCR-Variable festgelegte Citrix-Loginseite
direkt im Firefox aufruft. Ist diese Variable nicht konfiguriert oder
der Citrix Receiver nicht installiert wird eine HTML-Hinweisseite
ausgegeben.

Lokal abgespielte Flash-Medien werde unterstützt, wenn auf dem
UCC-System das Flash-Plugin installiert ist. Die Wiedergabe von
anderen Medien über HDX (MP3, WMV-Video) über den Windows Media Player
oder den Internet Explorer ist geplant (funktioniert aber aktuell
nicht). Die dafür nötigen Gstreamer-Pakete werden über ein Metapaket
installiert.

Massenspeicher wird in die Citrix-Sitzung weitergereicht, wenn es in der
Richtlinie des Rechners konfiguriert ist.

Getestet wird der Citrix-Support mit Citrix XenApp 6.5 unter Windows
2008 R2 und mit dem Citrix Receiver 12.1.


UCC:
Linux-Terminalsitzungen werden über einen SSH-Login
durchgeführt. Aktuell wird noch Univention Session verwendet, es
erzeugt aber eine sehr hohe Last und soll nach den aktuellen
Planungen noch entfernt werden (der Kommandokanal aus Univention
Session müsste dann durch SSH abgebildet werden). 

Sound wird über Pulseaudio remote verfügbar gemacht.

Der UCC-Terminalserver wird benutzerbezogen über eine Richtlinie
zugewiesen.

Ein UCC-Terminalserver ist ein System, das mit dem Desktop-Image
installiert wurde und auf dem das Paket
univention-ucc-application-server installiert wurde. Über ein
Join-Skript wird dann ein Service UCCTS
registriert. UCC-Terminalserver sind kerbifiziert und bringen ihre
eigene Keytab mit.




Bei der Einbindung von USB-Massenspeicher wird ein lokaler Mount über
eine udev-Regel durchgeführt. Die Terminalservice-Lösungen reichen
dann dieses Verzeichnis in die Terminalsession durch. Für die
Integration von  USB-CDROM/DVDROMs wird die zusätzliche Komponente
cdpinger integriert. vfat- und NTFS-Dateisysteme werden gemountet.



Support für USB-Massenspeicher in UCC-Terminalsitzungen: Auf den
Clients laufen udev-Regeln, die einen Mount der USB-Devices erkennen,
auf den Desktops der Nutzer werden Desktop-Icons abgelegt, die über
einen kio-Slave eine sftp-Verbindung auf den Thin Client erstellen.


Alle Dienste werden in UCC wie in Ubuntu über Upstart konfiguriert. Es
gibt dabei UCC-spezifische Upstart-Jobs und einzelne Kubuntu-Dienste
lassen sich über UCR-Variablen starten/stoppen.


UCC-Systeme, die über das Rollout-Verfahren installiert wurden, loggen
standarmässig remote per rsyslog. Remote Logging muss auf dem
UCS-System, auf dem die Logs angenommen werden sollen manuell
konfiguriert werden.



