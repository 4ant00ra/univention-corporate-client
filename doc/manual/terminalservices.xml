<chapter id="terminalservices:chapter">
  <title>Terminal services with UCC</title>

  <para>
	In addition to the operation of stationary UCC clients, UCC also supports
	access to terminal services. Login is supported to:
	<itemizedlist>
	  <listitem><simpara>UCC terminal servers</simpara></listitem>
	  <listitem><simpara>Windows terminal services via the RDP protocol</simpara></listitem>
	  <listitem><simpara>Citrix XenApp</simpara></listitem>
	</itemizedlist>
  </para>

  <para>
	There are three possibilities for configuring access to a terminal service:
	<itemizedlist>
	  <listitem><simpara>An interactive selection of the session by the
	  user during login to LightDM (see <xref
	  linkend="logins:sessions"/>)</simpara></listitem>
	  <listitem><simpara>A user login to LightDM where a session is
	  forcibly specified by the administrator</simpara></listitem>
	  <listitem><simpara>Automatic session selection where login is
	  performed with a guest user. In this case, no login dialogue is
	  shown.</simpara></listitem>
	</itemizedlist>
  </para>


  <section id="terminalservices:rdp">
	<title>RDP terminal services</title>
	<para>
	  UCC supports login to Windows 2003/2008/2012-based Windows terminal servers via the RDP
	  protocol. The Windows terminal servers can be joined in the UCS domain or alternatively the access
	  can be performed against an external domain.
	</para>

	<para>
	  The login is performed via the <emphasis>RDP</emphasis> session script installed as standard,
	  which uses <command>freerdp</command> for the access. The password entered by the user during
	  login to LightDM is cached by a PAM module and automatically provided to Freerdp, i.e., it is
	  not necessary to enter it again when logging in to the terminal server.
	</para>

	<para>
	  The RDP client Remmina is provided as a client with which an RDP connection can be
	  configured and started on the desktop.
	</para>

	<section id="terminalservices:rdp:setup">
	  <title>Installation</title>

	  <!-- <para> -->
	  <!-- 	Das Session-Skript für RDP (<package>univention-ucc-session-rdp</package>) ist in der -->
	  <!-- 	Grundeinstellung auf Desktop-Systemen und Thin Clients installiert. -->
	  <!-- </para> -->

	  <section id="terminalservices:rdp:umc">
		<title>Installation über den Setup-Wizard</title>

		<!-- <para> -->
		<!--   Zur Einrichtung des RDP-Zugriffs auf RDP Terminalserver muss der <guimenu>UCC -->
		<!--   Setup</guimenu> Wizard in der &ucsUMC; geöffnet werden. Unter <guimenu>Thin client -->
		<!--   configuration</guimenu> muss im Untermenü <guimenu>Configuration of terminal -->
		<!--   services</guimenu> die Option <guimenu>Configure access to a Windows/XRDP terminal -->
		<!--   server</guimenu> ausgewählt werden. -->
		<!-- </para> -->

		<!-- <para> -->
		<!--   Der Rechnername des RDP-Terminalservers muss im Eingabefeld <guimenu>Host name of terminal -->
		<!--   server</guimenu> eingetragen werden. Wird ein Windows-Terminalserver verwendet, muss der -->
		<!--   Domänenname im Eingabefeld <guimenu>Domain name</guimenu> eingetragen werden. Wird XRDP -->
		<!--   verwendet, kann das Feld freigelassen werden. -->
		<!-- </para> -->

		<para>
		  <!-- Soll Sound aus der Terminalsitzung an den zugreifenden Client übertragen werden, muss die -->
		  <!-- Option <guimenu>Enable sound</guimenu> aktiviert werden. -->
		  The sound output in the RDP session is transmitted via an RDP session channel.
		</para>

		<para>
		  <!-- USB-Massenspeicher (USB-Sticks oder CD/DVD-Laufwerke), die an den Thin Client angesteckt -->
		  <!-- werden, können in die RDP-Sitzung weitergeleitet werden. Dies geschieht durch Aktivieren -->
		  <!-- der Option <guimenu>Enable USB storage passthrough</guimenu>. Weitere Details zum Mounten -->
		  <!-- der Geräte findet sich in <xref linkend="hardware:usbthin"/>. -->
		  The transmission is performed via a session channel of the RDP protocol.
		</para>
	  </section>


	  <section id="terminalservices:rdp:setup:manually">
		<title>Installation ohne den UMC-Wizard</title>

		<para>
		  The terminal server and the Windows domain of the terminal server can be specified per
		  user via a <emphasis>UCC user session</emphasis> user policy. Alternatively, the server
		  and the domain can also be specified per client by setting the &ucsUCR; variables
		  <envar>rdp/domainname</envar> and <envar>rdp/server</envar>. 
		  <!-- Wird ein XRDP-Server als Terminalserver verwendet, kann <envar>rdp/domainname</envar> -->
		  <!-- freigelassen werden. -->
		</para>

		<para>
		  Mass storage devices mounted on the thin client (see <xref linkend="hardware:usbthin"/>)
		  is available in the RDP session if the &ucsUCRV; <envar>rdp/redirectdisk</envar> is set to
		  <emphasis>true</emphasis>. 
		</para>

		<para>
		  Sound output is enabled by default. It can be disabled by setting the &ucsUCRV;
		  <envar>rdp/disable-sound</envar> to <emphasis>true</emphasis>.
		</para>
	  </section>


	  <section id="terminalservices:rdp:setup:advanced">
		<title>Advanced configuration</title>

		<section id="terminalservices:rdp:crypto">
		  <title>Networklevel authentication / certificate approval</title>
		  <para>
			The RDP client does not use the "Network Level Authentication" (NLA) authentication
			method as standard. If NLA is enabled on the Windows terminal server, this can be
			enabled by setting the &ucsUCRV; <envar>rdp/checknla</envar> to
			<emphasis>true</emphasis>.
		  </para>

		  <para>
			Verification of the login certificate is also disabled as standard. It can be enabled by
			setting the &ucsUCRV; <envar>rdp/ignorecertificate</envar> to <emphasis>true</emphasis>.
		  </para>

		  <para>
			In special cases, it may be necessary to disable the TLS encryption of the RDP
			connection entirely. This is done by setting the &ucsUCRV; <envar>rdp/checktls</envar>
			to <emphasis>false</emphasis>.
		  </para>
		</section>

		<section id="terminalservices:rdp:furtheropts">
		  <title>Further configuration options for the RDP session</title>

		  <para>
			The &ucsUCRV; <envar>rdp/keyboard</envar> can be used to configure a different keyboard
			layout for the RDP session from that of the current client. The layout is specified in
			the same format as the &ucsUCRV; <envar>xorg/keyboard/options/XkbLayout</envar>.
		  </para>

		  <para>
			<envar>rdp/user</envar> can be used to specify a different user name from the current
			one during login.
		  </para>

		  <para>
			The &ucsUCRV; <envar>rdp/additionaloptions</envar> can be used to provide any additional
			options to freerdp (e.g., to enable additional plugins).
		  </para>

		  <para>
			<envar>rdp/geometry</envar> can be used to specify the screen resolution.
		  </para>

		</section>

	  </section>
	</section>
  </section>

  <section id="terminalservices:citrix">
	  <title>Citrix XenApp terminal services</title>
	  <para>
		UCC supports access to Citrix XenApp terminal servers. This
		documentation refers to Citrix XenApp 6.5 Enterprise on Windows
		Server 2008R2, which uses a Windows 2008R2 domain controller and the
		Citrix Receiver 13.
	  </para>

	  <para>
		Citrix XenApp supports two login methods:
		<itemizedlist>
		  <listitem><simpara>Access to the XenApp terminal server is
		  configured by an ICA session file in which the connection
		  parameters are configured.</simpara></listitem>
		  <listitem><simpara>The access is performed via a Citrix Farm web
		  interface the user logs in to. During the login, an ICA file
		  tailored to the user is generated, which is started via a browser
		  plugin in the Citrix Receiver client.</simpara></listitem>
		</itemizedlist>
	  </para>
	  <para>
		UCC only integrates the browser-based login method.
	  </para>


<section id="terminalservices:citrix:setup">
  <title>Installation</title>

  <section id="terminalservices:citrix:setup:umc">
	<title>Installation über den Setup-Wizard</title>
	<!-- <para> -->
	<!--   Zur Einrichtung von Citrix XenApp als Terminal Service muss der <guimenu>UCC Setup</guimenu> -->
	<!--   Wizard in der &ucsUMC; geöffnet werden. Unter <guimenu>Thin client configuration</guimenu> muss im -->
	<!--   Untermenü <guimenu>Configuration of terminal services</guimenu> die Option <guimenu>Configure -->
	<!--   access to a Citrix XenApp terminal server</guimenu> ausgewählt werden. -->
	<!-- </para> -->

	<!-- <para> -->
	<!--   Der Citrix Receiver kann aus Lizenzgründen nicht mit Univention Corporate Client ausgeliefert werden und muss über -->
	<!--   den angebotenen Download-Link als DEB-Datei heruntergeladen werden und in einem lokalen Verzeichnis gespeichert -->
	<!--   werden. In UCC 2.0 wird nur Citrix Receiver 13.0 unterstützt. -->
	<!-- </para> -->

	<!-- <para> -->
	<!--   Im Auswahlfeld <guimenu>Please select the image(..)</guimenu> muss nun das UCC-Thin Client-Image ausgewählt -->
	<!--   werden, in das der Citrix Receiver installiert werden soll. Nach einem Klick auf -->
	<!--   <guimenu>Upload</guimenu> wird nun die DEB-Datei des Citrix Receiver ausgewählt und -->
	<!--   automatisch in das UCC-Image integriert. -->
	<!-- </para> -->

	<!-- <para> -->
	<!--   In der Grundeinstellung muss jeder Benutzer des Citrix Terminalservers das End User License -->
	<!--   Agreement beim ersten Zugriff auf den Terminalserver bestätigen. Wird die Option -->
	<!--   <guimenu>Confirm the End User License Agreement of Citrix Receiver</guimenu> aktiviert, wird die -->
	<!--   Lizenz automatisch bestätigt. -->
	<!-- </para> -->

	<para>
	  <!-- Mit der Option <guimenu>URL for Citrix farm login</guimenu> wird die URL des Citrix -->
	  <!-- Web-Interfaces konfiguriert.  -->
	  The session script then opens the web interface directly in
	  Firefox during login.
	</para>
	
	<!-- <para> -->
	<!--   Da die Authentifizierung bei der Citrix-Anmeldung am Webinterface erfolgt und Citrix der einzige -->
	<!--   Terminalservice ist, ist eine zusätzliche Benutzeranmeldung am Thin Client nicht notwendig. Wird -->
	<!--   die Option <guimenu>Automatic Linux Desktop login</guimenu> aktiviert, erfolgt eine automatische -->
	<!--   Anmeldung an LightDM. -->
	<!-- </para> -->
	
  </section>

  <section id="terminalservices:citrix:setup:manually">
	<title>Installation ohne den UMC-Wizard</title>
	<!-- <para> -->
	<!--   Dieser Abschnitt beschreibt in kurzer Form die XenApp-Einrichtung für komplexere Szenarien, in -->
	<!--   denen der UCC-Setup-Wizard nicht zum Einsatz kommen soll. Für allgemeine Hinweise zu XenApp und -->
	<!--   UCC siehe <xref linkend="terminalservices:citrix:setup:umc"/> -->
	<!-- </para> -->
	
	<!-- <para> -->
	<!--   Der Citrix Receiver muss von <ulink -->
	<!--   url="http://www.citrix.de/downloads/citrix-receiver/linux/receiver-for-linux-130.html"/> -->
	<!--   als DEB-Datei heruntergeladen werden. -->
	<!-- </para> -->

	<!-- <para> -->
	<!--   Mit dem Tool <command>ucc-image-add-citrix-receiver</command> kann der Citrix Receiver in ein -->
	<!--   UCC-Thin Client-Image installiert werden. Der Parameter <emphasis>-i</emphasis> -->
	<!--   spezifiziert das UCC-Image und <emphasis>-d</emphasis> die DEB-Datei mit dem Citrix -->
	<!--   Receiver. Das Metapaket <package>univention-ucc-session-xenapp</package> wird automatisch -->
	<!--   installiert. -->
	<!-- </para> -->

	<!-- <para> -->
	<!--   Wenn die EULA automatisch bestätigt werden soll, muss die &ucsUCRV; -->
	<!--   <envar>citrix/accepteula</envar> über eine Richtlinie auf <emphasis>true</emphasis> gesetzt -->
	<!--   werden. Das Web-Interface für den Citrix-Login muss über die Variable -->
	<!--   <envar>citrix/webinterface</envar> konfiguriert werden. -->
	<!-- </para> -->

	<para>
	  To configure a login-less access to the web interface the &ucsUCRV;
	  <envar>lightdm/autologin/session</envar> must be set to <emphasis>XenApp</emphasis> and the
	  &ucsUCRV; <envar>lightdm/autologin</envar> to <emphasis>yes</emphasis>.
	</para>
  </section>

  <section id="terminalservices:citrix:setup:advanced">
	<title>Advanced configuration</title>

	<para>
	  The Citrix Receiver uses <filename>/dev/random</filename> as a
	  randomness source as standard. <filename>/dev/random</filename> blocks access if insufficient entropy is
	  available from hardware sources. This is the case on many thin clients. 
	  If the &ucsUCRV; <envar>citrix/linkdevrandom</envar> is set to <emphasis>true</emphasis>,
	  <filename>/dev/random</filename> is converted to a symbolic link to
	  <filename>/dev/urandom</filename> which prevents these delays.
	</para>
  </section>
</section>


<section id="terminalservices:citrix:soundusb">
<title>Sound transmission / Access to USB storage devices on the thin client</title>
<para>
  Configuration parameters such as full screen display or the
  sound transmission are configured in the Citrix Farm settings. They
  are then saved in the ICA file generated for the user during login
  and implemented by the Citrix Receiver.
</para>
<para>
  An USB storage device on a thin client (see <xref
  linkend="hardware:usbthin"/>) is available under Drive Z: in the
  Citrix session.
</para>
</section>

<section id="terminalservices:citrix:flash">
<title>Accelerating the playback of Flash videos</title>
<para>
  The Citrix client offers the possibility of optimising the
  playback of Flash videos: instead of streaming the video on the
  server and transmitting every image, the video is transmitted to the
  client and played locally in the terminal session. This requires
  the installation of the Flash plugin on the UCC client (included in
  the default settings).
</para>
</section>


</section>


</chapter>
